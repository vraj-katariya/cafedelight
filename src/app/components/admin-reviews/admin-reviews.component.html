<div class="admin-reviews-container">
  <div class="admin-header">
    <h2>Review Management</h2>
    <div class="admin-stats">
      <div class="stat-card">
        <h3>{{ totalReviews }}</h3>
        <p>Total Reviews</p>
      </div>
      <div class="stat-card">
        <h3>{{ averageRating | number: '1.1' }}</h3>
        <p>Average Rating</p>
      </div>
      <div class="stat-card">
        <h3>{{ todayReviews }}</h3>
        <p>Today's Reviews</p>
      </div>
    </div>
  </div>

  <div class="reviews-controls">
    <div class="search-filter">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        placeholder="Search reviews..."
        class="search-input">
      
      <select [(ngModel)]="filterRating" class="filter-select">
        <option value="">All Ratings</option>
        <option value="5">5 Stars</option>
        <option value="4">4 Stars</option>
        <option value="3">3 Stars</option>
        <option value="2">2 Stars</option>
        <option value="1">1 Star</option>
      </select>
    </div>
    
    <div class="bulk-actions">
      <button class="btn btn-danger" (click)="deleteSelectedReviews()" [disabled]="selectedReviews.length === 0">
        Delete Selected ({{ selectedReviews.length }})
      </button>
      <button class="btn btn-secondary" (click)="exportReviews()">
        Export Reviews
      </button>
    </div>
  </div>

  <div class="reviews-table-container">
    <table class="reviews-table">
      <thead>
        <tr>
          <th>
            <input 
              type="checkbox" 
              [(ngModel)]="selectAll" 
              (change)="toggleSelectAll()">
          </th>
          <th>Customer</th>
          <th>Rating</th>
          <th>Review</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let review of filteredReviews" [class.selected]="selectedReviews.includes(review.id)">
          <td>
            <input 
              type="checkbox" 
              [(ngModel)]="selectedReviews" 
              [value]="review.id">
          </td>
          <td>
            <div class="customer-info">
              <strong>{{ review.customerName }}</strong>
            </div>
          </td>
          <td>
            <div class="rating-display">
              <span class="stars">
                {{ getStarDisplay(review.rating) }}
              </span>
              <span class="rating-number">{{ review.rating }}/5</span>
            </div>
          </td>
          <td>
            <div class="review-text">
              {{ review.comment | truncate: 100 }}
              <button class="btn-link" (click)="showFullReview(review)" *ngIf="review.comment.length > 100">
                Read more
              </button>
            </div>
          </td>
          <td>{{ review.date | date: 'short' }}</td>
        </tr>
      </tbody>
    </table>

    <div class="no-reviews" *ngIf="filteredReviews.length === 0">
      <p>No reviews found matching your criteria.</p>
    </div>
  </div>

  <!-- Edit Review Modal -->
  <div class="modal-overlay" *ngIf="editingReview" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Edit Review</h3>
      <form (ngSubmit)="updateReview()">
        <div class="form-group">
          <label>Customer Name</label>
          <input type="text" [(ngModel)]="editingReview.customerName" name="customerName" required>
        </div>
        
        <div class="form-group">
          <label>Rating</label>
          <div class="star-rating">
            <span 
              *ngFor="let star of [1,2,3,4,5]" 
              class="star"
              [class.active]="star <= editingReview.rating"
              (click)="setEditRating(star)">
              ‚≠ê
            </span>
          </div>
        </div>
        
        <div class="form-group">
          <label>Review</label>
          <textarea [(ngModel)]="editingReview.comment" name="comment" rows="4" required></textarea>
        </div>
        
        <div class="modal-actions">
          <button type="submit" class="btn btn-primary">Update</button>
          <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Full Review Modal -->
  <div class="modal-overlay" *ngIf="viewingReview" (click)="closeViewModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Review Details</h3>
      <div class="review-details">
        <div class="detail-row">
          <strong>Customer:</strong> {{ viewingReview.customerName }}
        </div>
        <div class="detail-row">
          <strong>Rating:</strong> 
          <span class="stars">{{ getStarDisplay(viewingReview.rating) }}</span>
        </div>
        <div class="detail-row">
          <strong>Date:</strong> {{ viewingReview.date | date: 'full' }}
        </div>
        <div class="detail-row">
          <strong>Review:</strong>
          <p>{{ viewingReview.comment }}</p>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="closeViewModal()">Close</button>
      </div>
    </div>
  </div>
</div>
